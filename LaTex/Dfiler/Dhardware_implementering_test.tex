\chapter{HW implementering og test}

\section{Implementering}

\subsection{Forstærkerblok}
Som forstærkerblok anvendes INA114, se Figur 3.1. Denne har den fordel, at gain kan kontrolleres af en variabel modstand (potentiometer), $R_{G}$. 

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/Snip20151117_104}
	\caption{INA114}
\end{figure}

INA114 er blevet udleveret som én komponent. Den sorte boks på Figur 3.1 viser, hvilke komponenter INA114 indeholder. Det ses også, at $R_{G}$ er placeret udenfor den sorte boks, hvilket betyder, at det er en variabel modstand, der skal tilkobles INA114.     

\subsubsection{Forstærkning}
Forstærkningen, Gain, skal forstærke den maksimale inputsspænding fra tryktransduceren, så outputtet bliver 5 V, hvilket er det maksimale DAQ'en kan registrere. Udregningen for forstærkning kan ses i ligning (2.4) til (2.5).
\begin{equation}
	Gain = 370
\end{equation}


\subsubsection{Båndbredde}
For INA114 er produktet af båndbredden og forstærkningen en konstant på 1.000.000 \footnote{Se datablad for INA114 s. 2 i bilag}.
Båndbredden for denne forstærkerblok, hvor gain er 370, er 

\begin{equation}
	Gain \cdot BW = 1.000.000 \\ \Longrightarrow \\
	BW = \frac{1.000.000}{370} \\ \Longrightarrow \\
	BW = 2702 Hz
\end{equation} 

Båndbredden er større end 50 Hz, som var det, båndbredden mindst skulle være. 

\subsubsection{Gainmodstand}
Gainmodstanden, $R_{G}$ er en variabel modstand, der bestemmer forstærkningen i INA114. INA114 skal have en gain på 370. Ud fra ligning (3.3) kan $R_{G}$ isoleres og beregnes.\\

\begin{equation}
	Gain = 1+\frac{50k\Omega}{R_g} \\ \Longrightarrow \\
	R_{G} = \frac{50k\Omega}{Gain - 1} \\ \Longrightarrow \\
	R_{G} = \frac{50k\Omega}{370 - 1} \\ \Longrightarrow \\
	R_{G} = 135,5\Omega
\end{equation}


\section{Filterblok}
Som filter anvendes et Sallen Key lavpasfilter med unity gain.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/Snip20151117_105}
	\caption{Sallen Key lavpasfilter}
\end{figure}

\subsection{Beregning af komponentværdier}
Ud fra overføringsfunktion for filteret kan de forskellige komponentværdier beregnes. 

\subsubsection{Overføringsfunktion}
\begin{align}
	\frac{V_{out}(s)}{V_{in}(s)}=\frac{\frac{1}{R_1R_2C_1C_2}}{s^2+\frac{R_1+R_2}{R_1R_2C_2}+\frac{1}{R_1R_2C_1C_2}}
\end{align}

\subsubsection{Standardform}
\begin{align}
	\frac{V_{out}(s)}{V_{in}(s)}=\frac{w_n^2}{s^2+2\zeta\omega _n+w_n^2}
\end{align}

\begin{align}
	\omega _n = \sqrt{\frac{1}{R_1R_2C_1C_2}}
\end{align}

Kondensatoren, C2, skal være 680 nF og kondensatoren, C1, bestemmes til 340 nF, da denne kondensator kunne realiseres ud fra det, der var til rådighed. Der benyttes en kondensator på 330 nF og 10 nF til den realisering. Modstandene R1 og R2 skal være samme værdi, R = R1 = R2    

\begin{equation}
	50*2\pi = \sqrt{\frac{1}{R*340*10^{-9}*680*10^{-9}}} \\ \Longrightarrow \\
	Solve, R \\ \Longrightarrow \\
	R = 6620 \Omega
\end{equation}

\subsubsection{Magnitude Bodeplot}
Bodeplottet i Figur 3.3 viser, at ved -3 dB, hvor cutofffrekvens befinder sig er frekvensen 50 Hz, som var et krav. Det ses også, at grafen er faldet med 40 dB en dekade efter, 500 Hz, som også var et krav.   
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/Bodeplot_Lavpasfilter_Teoretisk}
	\caption{Magnitude Bodeplot Lavpasfilter}
	\label{fig:Bodeplot}
\end{figure}

\section{Test}
Forstærkeren og filteret testes via Analog Discovery \& Waveforms.

\subsection{Forstærkerblok}
Testopstillingen kan ses på Figur 3.4. 

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/Snip20151117_106}
	\caption{Testopstilling for forstærkeren}
\end{figure}

Der ønskes, at ved en indgangsspænding på 13,5 mV vil outputsspændingen være forstærket op til 5 V. Der kunne ikke påtrykkes en spænding på 13,5 mV, men istedet med 13 mV. Outputsspændingen ved 13 mV er 

\begin{equation}
	13 mV \cdot 370 = 4,8 V
\end{equation} 

Dette ser, at være det samme, når man tester forstærkeren. 

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/2015-11-17}
	\caption{Forstærker respons ved 13 mV}
\end{figure}


\subsection{Filterblok}
Testen af filteret foretaget, hvor der påtrykkes en AC spænding på 5 V, hvor frekvensen varieres imellem 1 Hz, 50 Hz og 500 Hz. \\ \\

Testopstillingen ses på Figur 3.6.  

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/Filterblok}
	\caption{Testopstilling af filteret}
	\label{fig:Filter}
\end{figure}

Channel 1 er indgangsspændingen og viser den varierende frekvens. Ændringen ses i venstre side af efterfølgende skærmbilleder. Oscilloskopet måler udgangsspændingen på filteret og resultatet vises i højre side af efterfølgende skærmbilleder.

\subsubsection{Filtering ved 1 Hz}
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/Lavpasfilter_Praktisk_1Hz}
	\caption{Lavpasfilter respons 1 Hz}
	\label{fig:Filter}
\end{figure}

Indgangsspændingen  og outpusspændingen er den samme, 5 V. Dette er også det ønskede resultat, da filteret er et lavpasfilter, der er designet til at lukke de lave frekvenser igennem indtil 50 Hz. 
 
\subsubsection{Filtering ved 50 Hz}
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/Lavpasfilter_Praktisk_50Hz}
	\caption{Lavpasfilter respons 50 Hz}
	\label{fig:Filter}
\end{figure}

Ved 50 Hz, som er filteret cutofffrekvens, skal indgangsspændingen være dæmpet med 3 dB efter filteringen. I ligningen (3.9) beregnes, hvad outputspændingen er efter en dæmpning med 3 dB. 

\begin{equation}
	3 dB = 20\cdot log(x) \\ \Longrightarrow \\
	x = 0,707 V\\ \Longrightarrow \\
	outputspænding = 5 V \cdot 0,707 V \\ \Longrightarrow \\
	outputspænding = 3,535 V 
\end{equation}

På Figur 3.8 ses, at det i praksis er 3,8, hvilket der er acceptabelt. 

\subsubsection{Filtering ved 500 Hz}
Her forventes, der en dæmpning med 40 dB, da det er et andenordens lavpasfilter, og 500 Hz er en dekade efter cutofffrekvensen. I ligning (3.10) ses beregningen, hvad outputspændingen er efter en dæmpning med 40 dB. 

\begin{equation}
	40 dB = 20\cdot log(x) \\ \Longrightarrow \\
	x = 0,01 V\\ \Longrightarrow \\
	outputspænding = 5 V \cdot 0,01 V \\ \Longrightarrow \\
	outputspænding = 0,05 V 
\end{equation}

På Figur 3.9 ses, at det i praksis er 633,6 mV.. Dette er ikke godt, da 633,6/1000 = 0,6, som ikke er tæt på 0,05....  

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/Lavpasfilter_Praktisk_500Hz}
	\caption{Lavpasfilter respons 500 Hz}
	\label{fig:Filter}
\end{figure}


