\chapter{Projektbeskrivelse}

\section{Projektgennemførelse}
Ud fra den givne projektformulering og tilgang til emnet er der udformet en tidsplan, som indeholder de overordnede deadlines for review og tests givet fra AU.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/Snip20151210_74.png}
	\caption{Overordnet tidsplan}
\end{figure}
Udviklingsprocessen, Scrum, er blandt andet blevet brugt i nedbrydning af selve opgaven i delelementer, hvor de vigtigste delopgaver er prioriteret først. Via Scrum inddeles arbejdet i sprints, hvilket tidsplanen ligeledes er blevet. Sprints er forskellige faser, som eksempelvis projektopstart, kravspecifikation, accepttest, design osv.\\\\
I tidsplanen er der markeret et P for det planlagte arbejde, hvor reviews er markeret med bogstavet R. Derudover er der markeret flueben i tidsplanen for udført arbejde. Flueben i parentes repræsenterer, hvornår arbejdet skulle have været færdig, men ikke blev det. Uge 42 er markeret med orange farve, da der var efterårsferie, og her var der heller ikke planlagt arbejde. Uge 47 og 48 er også markeret med orange farve og bogstavet P, da der i denne periode har været planlagt arbejde. Dette arbejde er dog ikke blevet udført grundet eksamenslæsning og eksamen.
\\\\
\\\\
\\\\
\subsection{Deadlines}
Der er fra projektets start blevet stillet deadlines til forskellige dele af projektet.

\begin{longtabu} to \linewidth{@{}l X[j]@{}}
	Dato &    Deadlines \\[-1ex]
	\midrule
	02.10.2015		&	Aflevering af kravspecifikation og accepttest til review-gruppen \\[-1ex]
	09.10.2015			&	Review af kravspecifikation og accepttest færdiggjort med review-gruppen\\[-1ex]
	06.11.2015		&	Aflevering af design til review-gruppen \\[-1ex]	
	13.11.2015		&	Review af design færdiggjort med review-gruppen \\[-1ex] 
	11.12.2015		&	Accepttest med vejleder\\[-1ex]
	16.12.2015		&	Aflevering af projekt\\[-1ex]
	\caption{Deadlines}
\end{longtabu}
De første to deadlines i Tabel 6.1 har omhandlet kravspecifikation og accepttesten, hvor kravspecifikation er blevet udarbejdet først, efterfulgt af accepttesten. Derudover har der været deadlines til design, samt accepttest med vejleder og projektaflevering. 

\subsection{Mødestruktur}
Der er blevet fastlagt mødestruktur ved projektets start, hvor alle gruppens medlemmer har udarbejdet en samarbejdsaftale. Et ugentligt møde med vejleder efterfulgt af gruppemøde er blevet afholdt hver onsdag. Derudover er der blevet holdt gruppearbejde/gruppemøde efter behov. Hvert møde er blevet indledt med en opsamling af projektet samt dagsorden. Facebook er blevet brugt til komminukation omkring møder, samt en fælles kalender over iCloud. \\\\ Der er blevet ført logbog for samtlige møder med vejleder, samt logbog ved møder gruppermedlemmerne imellem.

\subsection{ASE-modellen}
Projektets udviklingsproces har taget udgangspunkt i ASE-modellen, som ses på nedenstående figur. Denne afspejles desuden også i den overordnede tidsplan. 
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/asemodel}
	\caption{Udviklingsmodel: ASE-model \protect\cite[s. 6]{Vejledning}}
\end{figure}
ASE-modellen er en udviklingsmodel, der tager udgangspunkt i use cases, som defineres i kravspecifikationen i starten af projektarbejdet. ASE-modellen er inspireret af vandfaldsmodellen, hvor projektarbejdet opdeles i faser. Der fastlægges en opgaveformulering, kravspecifikation og systemarkitektur, for derefter at designe, implementere og teste de enkelte moduler i iterationer. Ud fra projektformuleringen specificeres kravspecifikationen som en række use cases, der beskriver de forskellige aktørers interaktion med systemet. Dette giver et overblik over, hvilke krav, der stilles til systemets funktionalitet. Ud fra kravspecifikationen bliver systemets accepttest udarbejdet. Efter kravspecifikationen er fastlagt, udarbejdes systemarkitekturen. Ud fra systemarkitekturen designes systemet ved at nedbryde det efter funktionalitet, som kan bindes til både software og hardware. \\\\
De første step i udviklingen af projektet iflg. ASE-modellen er blevet udarbejdet af alle gruppens medlemmer. Alle har bidraget til projektformuleringen, kravspecifikationen og accepttesten. I begyndelsen var der primært fokus på, at få dette færdiggjort, men der blev allerede her arbejdet på komponentværdier og udkast til hardwaren. I starten af projektarbejdet var det udtænkt, at alle gruppens medlemmer skulle arbejde med alle områder i projektet. Dette kunne ikke udføres rent tidsmæssigt, og derfor var en opdeling af arbejdsopgaver i mindre grupper nødvendig. Det blev delt op i software- og hardwarehold, dog var en del af hardwaren allerede beregnet og implementeret, da denne opdeling fandt sted. Tilbage af hardwaredelen var at lodde det på et veroboard og derefter teste det.\\\\

\subsection{V-modellen}
V-modellen er en udviklingsmodel opdelt i forskellige faser, der beskriver udviklingsfaserne og testfasrrne i projektet sideløbende. Denne model er blevet benyttet sideløbende med ASE-modellen, og fungerer således, at specifikationen af tests foregår sideløbende med udviklingen af selve systemet. Hver fase skal færdiggøres inden næste fase påbegyndes, hvilket også var tiltænkt i projektet. Dette blev dog ikke helt opfyldt i projektet, da der ofte blev rettet i tidligere faser, selvom de reelt skulle have været færdiggjort.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/vmodel}
	\caption{V-modellen, \protect\cite[s. 4]{Vejledning}, \protect\cite{ISE}}
\end{figure}
På ovenstående figur ses V-modellen, hvor den første fase er udvikingen af kravspecifikationen. Hertil udvikles en tilhørende accepttest, som gør det muligt, at tjekke om systemet opfylder de stillede krav. Næste fase er systemarkitekturen, hvor der ligeledes udvikles en tilhørende test. Testen skal undersøge integrationen mellem de implementerede moduler. De to sidste faser er design og implementering, som der udføres løbende tests af. 

\subsection{Vandfaldsmodellen}
Vandfaldsmodellen er en model, der ofte benyttes for udviklingen af software. Udviklingen af software foregår på den måde, at en ny fase af modulen først påbegyndes, når den foranliggende fase er færdiggjort, som kan ses på figuren nedenfor. 
\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{Figurer/vfmodel}
	\caption{Vandfaldsmodellen, \protect\cite{ISE}}
\end{figure}
De tre udviklingsmodeller hænger alle sammen på den måde, at der arbejdes i kronologisk logisk rækkefølge. De har suppleret hinanden alle tre, hvor ASE-modellen har skabt det overordnede overblik. Vandfaldsmodellen er den udviklingsproces, som der er blevet arbejdet efter i alle projektets facetter. V-modellen har sikret, at de nødvendige tests af systemet og de enkelte moduler har fundet sted. 



\section{Metode}
Dette afsnit har til formål at beskrive, hvilke metoder samt arbejdsredskaber, der er blevet benyttet til udarbejdelsen af software, hardware, rapport og dokumentation for projektet. 
\\\\
Der er blevet anvendt metoder samt viden fra forskellige kurser over 1.- 2.- og 3.semester. I kurset ST3KVI er der blevet benyttet viden om transducerprincippet samt generelt om blodtryksmåling, hvor der er i dette projekt fokuseres på den invasive blodtryksmåling. Fra kurserne ST2ITS2 og ST3ITS3 har viden om databasestruktur samt principperne om tre-lagsmodellen og Observer \& Stragety Pattern været grundlaget for opbygningen af softwaren. Et krav til projektet var, at der skulle kunne aktiveres og deaktiveres et digitalt filter. Til at designe dette filter blev der anvendt viden fra kurset E3DSB. Kurset ST1SUN1 har bidraget med viden om den anatomiske opbygning af hjertet samt blodtryk. Til beregning af komponentværdier, design og implementering af hardwaren er der blevet benyttet metoder og viden fra kurset E2ASB. Principperne om design diagrammer fra kurset I2ISE har bidraget til designafsnittet for hardware og software i dokumentationen. Alle kurserne har tilsammen været nødvendige for at kunne stå tilbage med dette specifkke produkt.
\\\\
Ud fra metoden SysML, er software- og hardwaredesign blevet specificeret. Det er en metode, der anvender forskellige diagrammer til henholdsvis at beskrive softwarens opbygning og kommunikation samt hardwarens. Selve systemet vil også via SysML-diagrammer blive beskrevet. Hensigten er at give læseren det store overblik over, hvilke aktører, der interagerer med systemet samt hvilken funktionalitet, der tillægges systemet.
\\ \\
Softwaren er også beskrevet gennem metoden UML, helt specifikt ved et UML klassediagram. Klassediagrammet viser, hvilke klasser og metoder al softwaren består af, samt hvordan systemet er bygget op efter tre-lagsmodellen.
\\\\
For at forstå det grundlæggende om blodtryk og blodtryksmåling er der blevet anvendt en redegørende metode, hvor der er blevet indsamlet viden gennem læsning af sundheds- og tekniskfaglige børger samt hjemmesider. Ud fra den viden har det været muligt, at redegøre for principperne samt analysere de resultater systemet har givet.
\\\\
Efter hardwarens funktionalitet var bestemt blev der benyttet den matematiske metode til at beregne de forskellige komponentværdier, der skulle til for at realisere den ønskede hardware.

\subsubsection{Arbejdsredskaber} 
Af benyttede arbejdsredskaber er der først og fremmest brugt en fælles arbejdsplatform, GitHub. GitHub er en online platform, hvor der er mulighed for at foretage ændringer samtidigt, og gemme i en fælles mappe. Yderligere er der mulighed for en detaljeret versionshistorik.\\
Alle SysML- og UML-diagrammer er udarbejdet i programmet Visio. Koden er skrevet i sproget C\# i programmet Visual Studio. Visual Studio spiller også sammen med programmet WaveForms Generator, i forbindelse med simulering af blodtrykssignalet. Selve rapporten, mødereferater, logbog og dokumentationen er udformet i tekstprogrammet LaTex. MatLab, som er et signalbehandlingsprogram samt matematikprogram, der er blevet benyttet til at udarbejdelse af hardwaren. Yderligere er Facebook brugt til mødeindkaldelse og generel kommunikation.



\section{Specifikation og analyse}
Dette afsnit har til formål at beskrive de løsninger, der benyttes i forhold til de valgte hardware- og software specifikationer. 

\subsection{Hardware}
Den udviklede hardware, som omtales signalbehandlingsblok, består af en forstærker samt et filter. Forstærkeren har til opgave at forstærke det elektriske signal, som tryktransduceren har transformeret ud fra en given trykændring. Filterets opgave er at frafiltrere unødige frekvenser for at få det mest optimale signal.
\\\\
\subsubsection{Tryktransducer}
Eksitationsspændingen for forstærkeren og filteret leveres af to 9 volts batterier. Der er valgt, at sætte en 5 volts regulator i forbindelse med tryktransduceren for at sikre, at strømmen gennem Wheatestone broen ikke bliver for stor. En for stor strøm kan give anledning til, at Wheatestone bro vil drive og de fire strain gauges i sidste ende kan brande af.\\
For at kunne beregne de tilstrækkelige komponentværdier for forstærkeren og filteret bestemmes en maksimal trykændring, den udviklede hardware skal kunne klare. Den maksimal trykændring for dette system er 0-300 mmHg. Da det er blodtryk, systemet skal kunne monitorere, er denne trykændring tilstrækkelig, da man ikke forventer, at et blodtryk vil komme over 300 mmHg.

\subsubsection{Forstærker}
Tryktransduceren vil transformere et tryk på 300 mmHg om til 7,5 mV, se Projektdokumentationen unden grænseflader for udregningen (2.2). Denne spændingen er forholdsvis lille og vil ikke udnytte DAQ'ens måleområde optimalt, som er valgt til +/- 5 V. Så for at få den bedste konvertering af det analoge signal til det digitale signal, skal spændingen forstærkes op til 5 V. 
\\\\
Til dette benyttes den ikke-inverterende operationsforstærker, INA114 samt et potentiometer, der fungere som gain-modstanden. Gain-modstanden er en variabel modstand, der kan variere i forhold til, hvilken forstærkning, der ønskes. Udregningen for forstærkningen ses i Projektdokumentationen under Hardware arkitektur (2.3) under ligningerne (2.4) og (2.5). Udregningen for gain-modstanden kan ses i Projektdokumentationen unden HW implementering og test (3) under ligning (3.3).     

\subsubsection{Filteret}
Det forstærkerede analoge signal skal videre filteres før det konventeres til det digitale signal. De relevante frekvenser, der udgør en blodtryksmåling, ligge mellem 0-50 Hz \cite[s. 10]{Billed for invasiv blodtryksmaling} . Derfor ønskes alle frekvenser over 50 Hz dæmpet.
\\\\
Til dette designes et Sallen Key anden ordens lavpasfilter med unity gain, hvor cutofffrekvensen er 50 Hz. Udregningerne for kompontværdierne til denne realisering, se HW implementering og test (3) i Projektdokumentationen under Filterblok (3.2).

\subsection{Software} 




        

\section{Arkitektur}
I følgende afsnit beskrives systemarkitekturen for blodtryksmålesystemet. Systemarkitekturen fungerer som en udviklingsramme for videreudviklingen af design og implementering. Her bliver systemets funktionalitet nedbrudt til overordnede moduler. Gennem dette afsnit ønskes der at skabe et overordnet overblik over systemet. Der benyttes diagrammer med tilhørende beskrivelser til at specificere og klarlægge systemkravene.

\subsection{Hardwarearkitektur}
Systemets hardware kan illustreres i et bdd og ibd, der beskriver det overordnede system og hvordan de forskellige hardwareblokke interagerer med hinanden. På Figur 6.5 ses bdd, der viser blodtryksmålesystemet bestående af fire hardwareblokke: Tryktransducer, Signalbehandling, DAQ og Computer. Hertil ses også hvilke porte, blokkene består af.
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/Snip20151209_70}
	\caption{bdd af blodtrykmålesystemet}
\end{figure}
Tryktransduceren registrerer en fysisk størrelse i form af en trykændring. Dennes opgave er at transformere det fysiske tryk til en elektrisk spænding, som derefter viderebehandles. Viderebehandlingen foregår i Signalbehandlingsblokken, som består af to dele: en forstærker og et filter. Her bliver det elektriske signal forstærket og filtreret således, at det er klar til at blive konverteret i DAQ’en fra et analogt til et digitalt signal. Computeren indeholder software til systemet, som kan vise det digitale signal grafisk samt kalibrere, nulpunktjustere og gemme målinger. Derudover kan software aktivere og deaktivere filteret.  
Bdd benyttes til at definere relationen mellem de forskellige blokke, som i dette tilfælde er en komposition. 
\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{Figurer/Snip20151209_72}
	\caption{ibd af blodtrykmålesystemet}
\end{figure}
På Figur 6.6 ses ibd for systemet, der viser signalets behandling gennem systemet. Signalet transformeres fra et målt fysisk tryk til et digitalt signal, som software kan viderebehandle og vise grafisk. For yderligere informationer om grænseflader (2.2) henvises der til Projektdokumentationen under Design. 
\subsection{Softwarearkitektur}
Systemets softwaredesign beskrives i dette afsnit via domænemodellen, som ses på Figur 6.7. Domænemodellen er skabt på baggrund af kravspecifikationens seks Use Cases, og viser et samlet overblik over systemet. 
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/dm}
	\caption{Domænemodel af blodtrykmålesystemet}
\end{figure}
I domænemodellen ses interaktionen mellem de konceptuelle klasser og aktører. Controlleren udfører kommandoer og sørger for, at systemet fungerer optimalt. Funktionaliteten af den enkelte kommando kan variere fra Use Case til Use Case. Domænemodellen viser desuden Forskerens interaktion med systemet. Forsker udfører en handling, der medfører igangsættelse af en række processer i systemet. 
For yderligere information om forløbene i de seks Use Cases (2.4.2) henvises der til Projektdokumentationen under Design. 


\section{Design, implementering og test}
I følgende afsnit vil design- og implementeringsprocessen for den udviklede hardware og software beskrives. Der vil være en beskrivelse af, hvordan de valgt løsninger er blevet testet. 

\subsection{Hardware}
Under afsnittet Specifikation og analyse (6.3.1) står specifikationer for Signalbehandlingsblokken beskrevet. Signalbehandlingsblokken består af en forstærker samt et filter. Kommunikationen internt for Signalbehandlingsblokken samt kommunikationen ud ad til ses i ibd for Signalbehandlingsblokken på Figur 6.8.  

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{Figurer/5}
	\caption{idb for Signalbehandlingsblokken}
\end{figure}

Til realisering af specifikationen for forstærkeren er der blevet beregnet den ønskede forstærkning samt gain-modstand, så et tryk på 300 mmHg forstærkes op til 5 V.\\
Udregningen for forstærkningen ses i Projektdokumentationen under Hardware arkitektur (2.3) under ligningerne (2.4) og (2.5). Udregningen for gain-modstanden kan ses i Projektdokumentationen unden HW implementering og test (3) under ligning (3.3).  
\\\\
Til realisering af specifikationen for filteret er der blevet beregnet de forskellige komponentværdier, så filteret får en cutofffrekvens ved 50 Hz.\\
Udregninger for komponentværdierne, ses under HW implementering og test (3) i Projektdokumentationen under Filterblok (3.2). 
\\\\ 
Signalbehandlingsblokken blev i starten af projektet implementeret på et fulmebræt. På Figur 6.9 ses denne opstillingen. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{Figurer/Snip20151213_83}
	\caption{Signalbehandlingsblokken implementeret på et fulmebræt}
\end{figure} 

Senere i implementeringsprocessen blevet Signalbehandlingsblokken implementeret på et veroboard. Dette blev valgt grundet bedre stabilitet samt udseende. På Figur 6.10 ses veroboardet. Det var også tænkt, at Signalbehandlingsblokken skulle have været implementeret på en printplade, hvor forbindelsen mellem komponenterne er lavet på forhånd. Printpladens design samt forbindelserne skulle først laves digitalt, først i programmet multisim og videre i programmet ultiboard. Dette blev nok ikke realiseret, da veroboardet fungerede som ønskede samt mangel på tid. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{Figurer/Snip20151207_46}
	\caption{Signalbehandlingsblokken implementeret på et veroboard}
\end{figure}

Signalbehandlingsblokken er blevet testet via Analog Discovery \& Waveforms. Først blev der lavet unit test, hvor forstærkeren og filteret testes hver for sig, hvor tilsidst der blev lavet en integrationtest, hvor signalbehandlingsblokken blev testet som en enhed. 
\\\\
Specifikationen for forstærkeren er, at den skal forstærke en spænding på 7,5 mV, der svarer til et tryk på 300 mmHg, op til 5 V. \\
Signalgeneratoren leverer inputspændingen, hvor oscilloskopet måler outputspændingen. Inputspændingen kan via Waveforms bestemmes. Til denne unit test af forstærkeren sættes inputspændingen til 7 mV. Reelt burde den sættes til 7,5 mV, men det er ikke muligt. \\
Den forventet outputspænding ved en inputspænding på 7 mV er 4,7 V, se Projektdokumentationen under Test af forstærkerblok (3.2.1) for udregningen samt dokumentationen af denne test.
Resultatet af testen stemte overens med det forventede. 
\\\\
Specifikationen for filteret er, at den skal dæmpe frekvenser over 50 Hz. Denne specifikation realiseres via et anden ordens lavpasfilter. \\
Til denne unit test af filteret sættes inputspændingen til 5 V. For at teste om det implementerede filter har en cutofffrekvens ved 50 Hz ændres inputspændingens frekvenser. Der laves ialt 3 tests. Først testes filteret, hvor frekvensen er 1 Hz. Her forventes, at outputspændingen er lig med inputspændingen. Derefter testes filteret, hvor frekvensen er 50 Hz. Her forventes, at outputspændingen er blevet dæmpet med 3 dB. Til sidste teste filteret, hvor frekvensen er 500 Hz. Her forventes, at outputspændingen er blevet dæmpet med 40 dB. I Projektdokumentationen under Test af filterblok (3.2.2) de forventede outputspændingen ved de forskellige frekvenser ses samt dokumentationen af denne unit test ses. 
Resultaterne af testen stemte overens med det forventede.  

    
 
 


 

\subsection{Software}

\section{Resultater og diskussion}

\section{Opnåede erfaringer}

\section{Fremtidigt arbejde}


